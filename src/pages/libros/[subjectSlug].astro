---
import { getCollection, getEntry } from 'astro:content';
import Layout from '@/layouts/Layout.astro'; 
import Container from '@/components/container.astro';

export async function getStaticPaths() {
  const asignaturas = await getCollection('asignaturas');
  return asignaturas.map((asignatura: any) => ({
    params: { subjectSlug: asignatura.slug },
  }));
}

const { subjectSlug } = Astro.params;

const asignaturaActual = await getEntry('asignaturas', subjectSlug!);

const todosLosLibros = await getCollection('libros');

const librosPorAsignatura = todosLosLibros
  .filter((libro: any) => libro.data.subject.id === subjectSlug)
  .sort((a: any, b: any) => (a.data.gradeOrder ?? 0) - (b.data.gradeOrder ?? 0)); 
---

<Layout title={`Libros de ${asignaturaActual?.data.title}`} content="Contribuimos con la producción intelectual de textos y productos académicos...">
  <Container>
    <h1 class="text-4xl font-bold text-center mb-2">
      Libros de {asignaturaActual?.data.title}
    </h1>
    <p class="text-center text-lg text-gray-600 mb-10">
      Explora nuestro material educativo para esta área.
    </p>

    <div class="space-y-8 max-w-4xl mx-auto">
      {
        librosPorAsignatura.map((libro: any) => {
          const parts = libro.id.split('/');
          const bookSlug = parts[1].replace(/\.md$/,'');
          return (
            <a 
              href={`/libros/${subjectSlug}/${bookSlug}`} 
              class="block bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition"
            >
              <h2 class="text-2xl font-bold text-violet-700">{libro.data.title}</h2>
              <p class="mt-2 text-gray-700">{libro.data.description}</p>
            </a>
          )

        })
      }
    </div>
  </Container>
</Layout>